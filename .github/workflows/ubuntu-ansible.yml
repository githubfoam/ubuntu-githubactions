name: "ubuntu ansible CI workflow"


on:
  push:
    branches: [ test ]

jobs:

  # ubuntu-1604-job:
  #   name: "osquery on ubuntu-16.04"
  #   runs-on: ubuntu-16.04
  #   steps:
  #   - uses: actions/checkout@v2
  #   - name: "os fingerprinting"
  #     run: hostnamectl status  
  #   - name: "install osquery"
  #     run: sudo sh scripts/install_osquery.sh      
  #   - name: "DFIR osquery list"
  #     run: sh scripts/dfir_osquery.sh   

  # ubuntu-1804-job:
  #   name: "osquery onubuntu-18.04"
  #   runs-on: ubuntu-18.04
  #   steps:
  #   - uses: actions/checkout@v2
  #   - name: "os fingerprinting"
  #     run: hostnamectl status  
  #   - name: "install osquery"
  #     run: sudo sh scripts/install_osquery.sh      
  #   - name: "DFIR osquery list"
  #     run: sh scripts/dfir_osquery.sh   

  # ubuntu-2004-job:
  #   name: "osquery on ubuntu-20.04"
  #   runs-on: ubuntu-20.04
  #   steps:
  #   - uses: actions/checkout@v2
  #   - name: "os fingerprinting"
  #     run: hostnamectl status 
  #   - name: "install osquery"
  #     run: sudo sh scripts/install_osquery.sh      
  #   - name: "DFIR osquery list"
  #     run: sh scripts/dfir_osquery.sh        

  ubuntu-latest-job:
    name: "ansible on ubuntu-latest"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: "os fingerprinting"
      run: hostnamectl status 
    - name: "check on ansible version"
      run: ansible --version

  ubuntu-latest-python-virtualenv-ansible-job:
    name: "python-virtualenv ansible on ubuntu-latest"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: "os fingerprinting"
      run: hostnamectl status 
    - name: "build virtualenv ansible "
      run: sudo make virtualenv-ansible     


  ubuntu-latest-python-virtualenv-ansible-playbook:
    name: "python-virtualenv ansible playbook on ubuntu-latest"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: "os fingerprinting"
      run: hostnamectl status 
    - name: "build virtualenv ansible "
      run: sudo make virtualenv-ansible     
    - name: "ansible locally"
      run: |
        # cat /etc/ansible/hosts #/etc/ansible/hosts: No such file or directory
        cat playbooks/localhost_playbook.yml 
        ansible-playbook playbooks/localhost_playbook.yml --check #dry-run mode
        ansible -m debug -a 'var=hostvars' localhost        
        ansible-inventory --inventory-file=inventory --list
        ansible-inventory --inventory-file=inventory --graph
        ansible-inventory --inventory-file=inventory --host localhost


  ubuntu-latest-python-virtualenv-ansible-version-job:
    name: "python-virtualenv ansible(specific version) on ubuntu-latest"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: "os fingerprinting"
      run: hostnamectl status 
    - name: "build virtualenv ansible version"
      run: sudo make virtualenv-ansible-specific     


  ubuntu-latest-snmpv3-job:
    name: "snmpv3 on ubuntu-latest"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: "os fingerprinting"
      run: hostnamectl status 
    - name: "deploy snmp v3"
      run: sudo make deploy-snmpv3

  ubuntu-latest-snmpv3-playbook:
    name: "snmpv3 ansible playbook on ubuntu-latest"
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    - name: "os fingerprinting"
      run: hostnamectl status 
    - name: "build virtualenv ansible "
      run: sudo make virtualenv-ansible     
    - name: "ansible locally"
      run: |
        ansible all -i "localhost," -c local -m shell -a 'hostnamectl status'
        # cat /etc/ansible/hosts #/etc/ansible/hosts: No such file or directory
        ansible-playbook playbooks/localhost_playbook.yml --check #dry-run mode
        ansible -m debug -a 'var=hostvars' localhost        
        ansible-inventory --inventory-file=inventory --list
        ansible-inventory --inventory-file=inventory --graph
        ansible-inventory --inventory-file=inventory --host localhost
        ansible-playbook playbooks/localhost_playbook.yml --check    
        ansible-playbook playbooks/localhost_playbook.yml --tags "ruby-gem-install"
    - name: "run snmp v3 playbook"
      run: |
        ansible all -i "localhost," -c local -m shell -a 'hostnamectl status'
        # cat /etc/ansible/hosts #/etc/ansible/hosts: No such file or directory
        ansible-playbook playbooks/localhost_playbook.yml --check #dry-run mode
        ansible -m debug -a 'var=hostvars' localhost        
        ansible-inventory --inventory-file=inventory --list
        ansible-inventory --inventory-file=inventory --graph
        ansible-inventory --inventory-file=inventory --host localhost
        ansible-playbook playbooks/localhost_playbook.yml --check    
        ansible-playbook playbooks/localhost_playbook.yml --tags "snmp-v3"
    - name: "run jenkins playbook"
      run: |
        ansible-playbook playbooks/localhost_playbook_jenkins.yml --check    
     
 